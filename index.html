<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptiWeight-PC Decision Aid Tool</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="script.js" defer></script>
</head>
<body>
    <div class="container">
        <h1>OptiWeight-PC Decision Aid Tool</h1>
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="introduction">Introduction</button>
            <button class="tab-btn" data-tab="attributes">Attributes & Levels</button>
            <button class="tab-btn" data-tab="inputs">Inputs</button>
            <button class="tab-btn" data-tab="uptake">Predicted Uptake</button>
            <button class="tab-btn" data-tab="cost-benefit">Cost-Benefit Analysis</button>
            <button class="tab-btn" data-tab="scenarios">Saved Scenarios</button>
        </nav>
        
        <div id="introduction" class="tab-content active">
            <h2>Introduction</h2>
            <p>This professional tool assists patients, clinicians, and policymakers in evaluating weight loss strategies for obese individuals with prostate cancer before robotic-assisted radical prostatectomy. It integrates patient preferences from Discrete Choice Experiments (DCE) with cost-benefit analyses to predict intervention uptake and economic viability, drawing from clinical trials like STEP-1 and Look AHEAD.</p>
            <p>Weight loss can significantly lower surgery complications, such as a 20% reduction in incontinence risk. Semaglutide (Wegovy) typically achieves ~5.54 kg/m² BMI reduction over 12 months but may cause gastrointestinal side effects. Lifestyle changes (diet/exercise via NHS app) are safer but may have lower efficacy. Navigate the tabs to input attributes, calculate predictions, simulate uncertainty, and generate reports.</p>
        </div>
        
        <div id="attributes" class="tab-content">
            <h2>Attributes & Levels</h2>
            <p>These attributes define the key features of weight loss programs, based on clinical research and trial data. Hover over the "?" for detailed tooltips.</p>
            <div class="attribute-list">
                <div class="attribute-box">
                    <strong>BMI</strong><span class="tooltip" data-tooltip="Body Mass Index measures obesity; higher values increase surgical risks like incontinence and complications. Range ensures eligibility for the proposed trial.">?</span><br>
                    <strong>Levels</strong>: 27-35 kg/m²<br>
                    <strong>Description</strong>: Patient's starting BMI, a critical factor for perioperative optimization.
                </div>
                <div class="attribute-box">
                    <strong>Cost per Month (£)</strong><span class="tooltip" data-tooltip="Monthly expense, including drug acquisition (Semaglutide ~£73 starter to £175 maintenance per NHS/BNF pricing) or lifestyle program fees. Impacts patient uptake and cost-effectiveness.">?</span><br>
                    <strong>Levels</strong>: £0-300<br>
                    <strong>Description</strong>: Financial burden of the intervention, influencing accessibility and guideline adoption.
                </div>
                <div class="attribute-box">
                    <strong>Efficacy (BMI Reduction)</strong><span class="tooltip" data-tooltip="Expected BMI decrease from trials like STEP-1; e.g., 5.54 kg/m² with Semaglutide reduces post-op incontinence by ~20% (meta-analysis data). Higher efficacy improves oncological and functional outcomes.">?</span><br>
                    <strong>Levels</strong>: 0-10 kg/m²<br>
                    <strong>Description</strong>: Measure of weight loss effectiveness, directly linked to reduced surgical complications.
                </div>
                <div class="attribute-box">
                    <strong>Side Effects</strong><span class="tooltip" data-tooltip="Severity levels: None (typical for lifestyle), Mild (e.g., nausea with GLP-1 agonists), Moderate (GI issues). Affects patient preference and compliance in DCE studies.">?</span><br>
                    <strong>Levels</strong>: None, Mild, Moderate<br>
                    <strong>Description</strong>: Potential adverse effects, a key consideration for patient-centered decision-making.
                </div>
                <div class="attribute-box">
                    <strong>Frequency</strong><span class="tooltip" data-tooltip="Administration schedule: Weekly for Semaglutide injections, Monthly for lifestyle check-ins. Influences convenience and adherence rates.">?</span><br>
                    <strong>Levels</strong>: Weekly, Monthly<br>
                    <strong>Description</strong>: How often the intervention is required, impacting patient burden.
                </div>
                <div class="attribute-box">
                    <strong>Method</strong><span class="tooltip" data-tooltip="Delivery mode: Injection (Semaglutide, pharmacological), Lifestyle (diet/exercise via NHS Weight Loss Plan app). Method affects efficacy, cost, and side effects profile.">?</span><br>
                    <strong>Levels</strong>: Injection, Lifestyle<br>
                    <strong>Description</strong>: Approach to weight loss, balancing medical vs. behavioral strategies.
                </div>
                <div class="attribute-box">
                    <strong>Duration (months)</strong><span class="tooltip" data-tooltip="Program length: 6 months (short-term pre-op), 12 months (full peri-op, covering recovery). Longer duration may enhance continence restoration per Look AHEAD data.">?</span><br>
                    <strong>Levels</strong>: 6, 12<br>
                    <strong>Description</strong>: Timeframe of the intervention, aligned with prostatectomy delay window (up to 6 months safe).
                </div>
                <div class="attribute-box">
                    <strong>Programme Type</strong><span class="tooltip" data-tooltip="Structure: Combined (Semaglutide + lifestyle for synergistic effects), Lifestyle Alone (diet/exercise, lower cost/risk). Combined may yield 38% lower incontinence odds.">?</span><br>
                    <strong>Levels</strong>: Combined, Lifestyle Alone<br>
                    <strong>Description</strong>: Overall program design, optimizing for efficacy and feasibility.
                </div>
            </div>
        </div>
        
        <div id="inputs" class="tab-content">
            <h2>Inputs</h2>
            <p>Customize the program attributes below. Click Calculate to view results and recommendations in a popup. Simulate to explore uncertainty.</p>
            <form id="inputForm">
                <div class="input-box">
                    <label>BMI (27-35 kg/m²):</label>
                    <input type="range" id="bmi" min="27" max="35" value="30" step="0.1" required>
                    <span id="bmiValue">30</span>
                </div>
                <div class="input-box">
                    <label>Cost per Month (£):</label>
                    <input type="range" id="cost" min="0" max="300" value="175" step="1" required>
                    <span id="costValue">175</span>
                </div>
                <div class="input-box">
                    <label>Efficacy (BMI Reduction):</label>
                    <input type="range" id="efficacy" min="0" max="10" value="5.54" step="0.1" required>
                    <span id="efficacyValue">5.54</span>
                </div>
                <div class="input-box">
                    <label>Side Effects:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="side_effects" value="0" checked> None</label>
                        <label><input type="radio" name="side_effects" value="1"> Mild</label>
                        <label><input type="radio" name="side_effects" value="2"> Moderate</label>
                    </div>
                </div>
                <div class="input-box">
                    <label>Frequency:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="frequency" value="weekly" checked> Weekly</label>
                        <label><input type="radio" name="frequency" value="monthly"> Monthly</label>
                    </div>
                </div>
                <div class="input-box">
                    <label>Method:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="method" value="injection" checked> Injection</label>
                        <label><input type="radio" name="method" value="lifestyle"> Lifestyle</label>
                    </div>
                </div>
                <div class="input-box">
                    <label>Duration (months):</label>
                    <div class="radio-group">
                        <label><input type="radio" name="duration" value="6"> 6</label>
                        <label><input type="radio" name="duration" value="12" checked> 12</label>
                    </div>
                </div>
                <div class="input-box">
                    <label>Programme Type:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="programme" value="combined" checked> Combined</label>
                        <label><input type="radio" name="programme" value="lifestyle"> Lifestyle Alone</label>
                    </div>
                </div>
            </form>
            <div class="button-group">
                <button id="calculateBtn">Calculate</button>
                <button id="simulateBtn">Simulate Uncertainty</button>
            </div>
            <div id="resultsPopup" class="popup">
                <div class="popup-content">
                    <span class="close-popup">×</span>
                    <h3>Calculation Results</h3>
                    <div id="popupResults"></div>
                    <div id="recommendations"></div>
                </div>
            </div>
        </div>
        
        <div id="uptake" class="tab-content">
            <h2>Predicted Uptake</h2>
            <p>Shows the percentage of patients likely to choose this program based on preferences from DCE research. Higher uptake indicates greater acceptability.</p>
            <div id="uptakeResults"></div>
            <canvas id="uptakeChart"></canvas>
        </div>
        
        <div id="cost-benefit" class="tab-content">
            <h2>Cost-Benefit Analysis</h2>
            <p>Compares detailed costs (e.g., drug acquisition, monitoring) to benefits (savings from reduced complications, QALY gains). Benefits are dynamically scaled by uptake probability for realistic projections. Costs derived from NHS/BNF data; benefits from Bolenz et al. and NICE guidelines.</p>
            <div id="cbaResults"></div>
            <canvas id="cbaChart"></canvas>
            <canvas id="simChart"></canvas>
        </div>
        
        <div id="scenarios" class="tab-content">
            <h2>Saved Scenarios</h2>
            <p>Save multiple scenarios for comparison, enabling iterative analysis to identify optimal interventions.</p>
            <ul id="scenarioList"></ul>
            <div class="button-group">
                <button id="saveScenarioBtn">Save Current Scenario</button>
                <button id="generatePDFBtn">Generate PDF Report</button>
            </div>
        </div>
    </div>
</body>
</html>
