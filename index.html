<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OptiWeight-PC Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="script.js" defer></script>
</head>
<body>
  <header>
    <h1>OptiWeight-PC Decision Aid Tool</h1>
  </header>
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab="intro">Introduction</button>
    <button class="tab-btn" data-tab="attr">Attributes & Levels</button>
    <button class="tab-btn" data-tab="inputs">Inputs</button>
    <button class="tab-btn" data-tab="uptake">Predicted Uptake</button>
    <button class="tab-btn" data-tab="cba">Cost-Benefit</button>
    <button class="tab-btn" data-tab="scenarios">Saved Scenarios</button>
  </nav>
  <main>
    <!-- INTRODUCTION -->
    <section id="intro" class="tab-content active">
      <div class="card">
        <h2>Purpose and Methodology</h2>
        <p>
          The OptiWeight-PC tool is designed to support clinical and policy decision-making for pre-operative weight management in men with obesity and prostate cancer. This platform integrates patient preference data, efficacy evidence, and cost-effectiveness principles to predict real-world uptake and health-economic value of alternative weight loss strategies.
        </p>
        <h3>How to Use This Tool</h3>
        <ol>
          <li>Review the intervention attributes and their clinical significance.</li>
          <li>Customise the programme on the <b>Inputs</b> tab.</li>
          <li>View modelled patient uptake, detailed cost-benefit analysis, and ICER simulation under uncertainty.</li>
          <li>Save different configurations and export a comprehensive report.</li>
        </ol>
        <div class="info-panel">
          <strong>Evidence Base:</strong> Data from STEP-1, LookAHEAD, Bolenz et al. (2010), NHS Digital App, and published DCE literature.<br>
          For full methodology, see <a href="https://www.thelancet.com/journals/lanpub/article/PIIS2468-2667(21)00012-8/fulltext" target="_blank">The Lancet Public Health</a>.
        </div>
      </div>
    </section>
    <!-- ATTRIBUTES -->
    <section id="attr" class="tab-content">
      <h2>Programme Attributes and Levels</h2>
      <div class="canvas">
        <div class="grid attr-grid">
          <div class="box">
            <strong>BMI</strong>
            <span class="tip" data-tip="Baseline BMI. Tool applies to BMI 27–35 kg/m².">?</span>
            <div class="level">27–35 kg/m²</div>
            <div class="desc">Eligibility for pre-operative programme.</div>
          </div>
          <div class="box">
            <strong>Cost per Month (£)</strong>
            <span class="tip" data-tip="Monthly patient or payer cost. NHS Wegovy ~£175/mo.">?</span>
            <div class="level">0–300</div>
            <div class="desc">Range covers medication, app, and professional support.</div>
          </div>
          <div class="box">
            <strong>Efficacy (BMI reduction)</strong>
            <span class="tip" data-tip="Expected BMI change over 12 months.">?</span>
            <div class="level">0–10 kg/m²</div>
            <div class="desc">Semaglutide: ~5.5; Lifestyle: 1–4; Combined: 4–7.</div>
          </div>
          <div class="box">
            <strong>Side-effects</strong>
            <span class="tip" data-tip="Severity: 0=None, 1=Mild, 2=Moderate.">?</span>
            <div class="level">None, Mild, Moderate</div>
            <div class="desc">GI side-effects (nausea) common with injections.</div>
          </div>
          <div class="box">
            <strong>Frequency</strong>
            <span class="tip" data-tip="Visit or injection frequency.">?</span>
            <div class="level">Weekly, Monthly</div>
            <div class="desc">Injection: weekly. App/coach: monthly.</div>
          </div>
          <div class="box">
            <strong>Method</strong>
            <span class="tip" data-tip="Delivery: Injection or lifestyle-only.">?</span>
            <div class="level">Injection, Lifestyle</div>
            <div class="desc">Lifestyle: digital/app-based or in-person.</div>
          </div>
          <div class="box">
            <strong>Duration</strong>
            <span class="tip" data-tip="Programme length in months.">?</span>
            <div class="level">6, 12 months</div>
            <div class="desc">Longer duration may increase benefit, cost, and risk.</div>
          </div>
          <div class="box">
            <strong>Programme Type</strong>
            <span class="tip" data-tip="Combined (drug + lifestyle) vs lifestyle alone.">?</span>
            <div class="level">Combined, Lifestyle</div>
            <div class="desc">Combined is more effective but costlier and may have more side-effects.</div>
          </div>
        </div>
      </div>
      <div class="card">
        <h3>Interpretation Guidance</h3>
        <ul>
          <li><b>Greater efficacy</b> (larger BMI loss) is linked to lower surgical risk and better quality of life.</li>
          <li><b>Severe side-effects</b> and higher costs reduce patient uptake.</li>
          <li><b>Combined approaches</b> yield the best health outcomes but may be less cost-effective if uptake is low or cost is high.</li>
        </ul>
      </div>
    </section>
    <!-- INPUTS -->
    <section id="inputs" class="tab-content">
      <h2>Customise Your Programme</h2>
      <div class="canvas">
        <form id="inputForm" class="grid input-grid">
          <div class="box">
            <label for="bmi">BMI (<span id="bmiVal">30</span>)</label>
            <input type="range" id="bmi" min="27" max="35" step="0.1" value="30">
            <div class="mini-desc">Select the patient's BMI (27–35 kg/m²).</div>
          </div>
          <div class="box">
            <label for="cost">Cost per Month £ (<span id="costVal">175</span>)</label>
            <input type="range" id="cost" min="0" max="300" step="1" value="175">
            <div class="mini-desc">Monthly programme cost (drug, app, support).</div>
          </div>
          <div class="box">
            <label for="eff">Efficacy kg/m² (<span id="effVal">5.5</span>)</label>
            <input type="range" id="eff" min="0" max="10" step="0.1" value="5.5">
            <div class="mini-desc">Expected BMI reduction at 12 months.</div>
          </div>
          <div class="box">
            <label>Side-effects</label>
            <div class="radio-group">
              <label><input type="radio" name="side" value="0" checked>None</label>
              <label><input type="radio" name="side" value="1">Mild</label>
              <label><input type="radio" name="side" value="2">Moderate</label>
            </div>
            <div class="mini-desc">Estimate severity for chosen method.</div>
          </div>
          <div class="box">
            <label>Frequency</label>
            <div class="radio-group">
              <label><input type="radio" name="freq" value="weekly" checked>Weekly</label>
              <label><input type="radio" name="freq" value="monthly">Monthly</label>
            </div>
          </div>
          <div class="box">
            <label>Method</label>
            <div class="radio-group">
              <label><input type="radio" name="method" value="injection" checked>Injection</label>
              <label><input type="radio" name="method" value="lifestyle">Lifestyle</label>
            </div>
          </div>
          <div class="box">
            <label>Duration (months)</label>
            <div class="radio-group">
              <label><input type="radio" name="dur" value="6">6</label>
              <label><input type="radio" name="dur" value="12" checked>12</label>
            </div>
          </div>
          <div class="box">
            <label>Programme Type</label>
            <div class="radio-group">
              <label><input type="radio" name="prog" value="combined" checked>Combined</label>
              <label><input type="radio" name="prog" value="lifestyle">Lifestyle</label>
            </div>
          </div>
          <div class="full-span btn-row">
            <button id="calcBtn" class="primary">Calculate</button>
            <button id="simBtn" class="secondary" disabled>Simulate Uncertainty</button>
          </div>
          <div id="warn" class="full-span warn"></div>
        </form>
        <div id="popup" class="modal">
          <div class="modal-content">
            <span class="close">×</span>
            <div id="popupBody"></div>
          </div>
        </div>
      </div>
    </section>
    <!-- PREDICTED UPTAKE -->
    <section id="uptake" class="tab-content">
      <h2>Predicted Uptake</h2>
      <div class="card">
        <p>
          This section displays the proportion of patients expected to accept the specified programme. Uptake is derived from a validated discrete choice model and is sensitive to programme cost, efficacy, side-effects, and delivery method. Programmes with low predicted uptake are unlikely to deliver meaningful population benefit, even if clinically effective.
        </p>
      </div>
      <div id="upText" class="up-details"></div>
      <canvas id="upChart"></canvas>
      <div class="chart-explanation">
        <ul>
          <li><b>Green:</b> % predicted to accept the programme</li>
          <li><b>Red:</b> % likely to opt out</li>
        </ul>
        <p>
          Higher uptake supports broader adoption and policy investment. Consider optimising both clinical efficacy and patient-centred acceptability.
        </p>
      </div>
    </section>
    <!-- COST-BENEFIT -->
    <section id="cba" class="tab-content">
      <h2>Cost-Benefit Analysis</h2>
      <div class="card">
        <p>
          The economic model combines direct costs (drug, monitoring, admin, training) with clinical and quality-of-life benefit (surgical complication savings, QALY gain). The Incremental Cost-Effectiveness Ratio (ICER) is calculated and a probabilistic sensitivity analysis simulates uncertainty.
        </p>
      </div>
      <div id="cbTable"></div>
      <canvas id="cbChart"></canvas>
      <div class="chart-explanation">
        <p>
          <b>Interpretation:</b> Lower cost, higher net benefit, and ICER below the threshold (commonly £20,000–£30,000/QALY in the UK) suggest strong value for money.
        </p>
      </div>
      <div style="margin:32px 0 0 0;">
        <h3>ICER Uncertainty Simulation</h3>
        <p>
          This histogram displays 500 model runs with ±30% variation in both cost and QALY value, illustrating the plausible range of ICER results. A narrow, low-distribution indicates robust cost-effectiveness.
        </p>
        <canvas id="simChart" style="display:none"></canvas>
      </div>
    </section>
    <!-- SAVED SCENARIOS -->
    <section id="scenarios" class="tab-content">
      <h2>Saved Scenarios and Report Export</h2>
      <div class="card">
        <p>
          Save multiple programme configurations for side-by-side comparison. Use the export button to create a detailed PDF report of all results and plots for clinical records or policy review.
        </p>
      </div>
      <ul id="scList"></ul>
      <div class="btn-row">
        <button id="saveBtn" class="primary">Save Current Scenario</button>
        <button id="pdfBtn" class="secondary">Export PDF Report</button>
      </div>
    </section>
  </main>
</body>
</html>
